webpackJsonp([13],{NR3j:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("3SZ7"),r=a.n(o),s=a("34v0"),i=a.n(s),l=a("EcfS"),d=a("m4jk"),n={data:function(){var e=this;return{uploadedFile:null,loadingStatus:!1,dateRange:[new Date((new Date).getTime()-2592e5),new Date((new Date).getTime()+1728e5)],dateOptions:{shortcuts:[{text:"最近一周",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-6048e5),[t,e]}},{text:"最近一个月",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-2592e6),[t,e]}},{text:"最近三个月",value:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-7776e6),[t,e]}}]},keyword:"",showAddModal:!1,showEditModal:!1,showDeleteModal:!1,addModel:{name:"",brand:"",effective_month:0,sale_price:0,price:0,is_active:!1,is_bestseller:!1,end_datetime:"2017-06-18T03:02:20Z",description:"",meta_keywords:"",meta_description:""},addModelErrors:{},editModel:{name:"",brand:"",effective_month:0,sale_price:0,price:0,is_active:!1,is_bestseller:!1,end_datetime:"",description:"",meta_keywords:"",meta_description:""},editModelErrors:{},deleteModel:{name:"",sale_price:0},ruleValidate:{name:[{required:!0,message:"给商品取个名字吧",trigger:"blur"},{type:"string",min:2,message:"多赐几个字嘛",trigger:"blur"}],brand:[{required:!1,trigger:"blur"},{type:"string",trigger:"blur"}],sale_price:[{required:!0,type:"number",min:0,max:1e4,message:"介是几个钱？",trigger:"blur"}],price:[{required:!1,type:"number",min:0,max:1e4,message:"介是几个钱？",trigger:"blur"}],is_active:[{required:!0,type:"boolean",trigger:"blur"}],is_bestseller:[{required:!0,type:"boolean",trigger:"blur"}],description:[{required:!1,message:"不描述一下商品吗？",trigger:"blur"}],meta_keywords:[{required:!1,message:"添加搜索关键词？",trigger:"blur"}],meta_description:[{required:!1,message:"添加搜索关键描述？",trigger:"blur"}]},self:this,tableData:[],total:0,pageNumber:1,pageSize:10,tableColumns:[{title:"名称",key:"name",align:"center",sortable:!0},{title:"价格",key:"sale_price",align:"left",sortable:!0,render:function(e,t){return e("span",t.row.sale_price)}},{title:"是否在售",key:"is_active",align:"center",sortable:!0,filters:[{label:"停售",value:!1},{label:"在售",value:!0}],filterMultiple:!1,filterMethod:function(e,t){return!0===e?!0===t.is_active:!1===e?!1===t.is_active:void 0},render:function(e,t){return e("Tag",{props:{type:"dot",color:t.row.is_active?"green":"red"}},t.row.is_active?"在售":"停售")}},{title:"描述",key:"description",align:"left",sortable:!0},{title:"操作",key:"action",width:150,align:"center",render:function(t,a){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showEdit(a.index)}}},e.$t("edit")),t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showDelete(a.index)}}},e.$t("toggle"))])}}]}},computed:i()({},Object(l.e)("app",{maxSize:function(e){return e.maxSize}}),Object(l.e)("login",{accessToken:function(e){return e.accessToken}}),{headers:function(){var e={};return e.Authorization="Token "+this.accessToken,e},aList:function(){var e=this;return Array.isArray(this.tableData)?this.tableData.filter(function(t,a,o){return!e.keyword||(-1!==t.name.toUpperCase().indexOf(e.keyword.toUpperCase())?o.indexOf(t)===a:-1!==t.sale_price.toString().indexOf(e.keyword.toUpperCase())||(-1!==t.pinyin.toUpperCase().indexOf(e.keyword.toUpperCase())||-1!==t.py.toUpperCase().indexOf(e.keyword.toUpperCase())))}):[]}}),methods:{showEdit:function(e){this.showEditModal=!0,this.editModel=this.aList[e],this.editModel.sale_price=Number(this.editModel.sale_price),this.editModel.price=Number(this.editModel.price)},showDelete:function(e){this.showDeleteModal=!0,this.deleteModel=this.tableData[e]},cancelDelete:function(e){this.showDeleteModal=!1,this.$Message.info("点击了取消")},getProductData:function(e,t){var a=this;this.loadingStatus=!0;var o={start:this.dateRange[0].getFullYear()+"-"+(this.dateRange[0].getMonth()+1)+"-"+this.dateRange[0].getDate(),end:this.dateRange[1].getFullYear()+"-"+(this.dateRange[1].getMonth()+1)+"-"+this.dateRange[1].getDate(),keyword:this.keyword,limit:e,offset:(t-1)*e};Object(d.v)(o).then(function(e){var t=e.data,o=e.status,r=e.statusText;200!==o?a.loginMessage=r:(console.log(t),a.$Loading.finish(),a.total=e.data.count,a.tableData=t.results)},function(e){console.log("Error in searchProducts: "+e),a.$Message.error("获取商品列表失败!")}).catch(function(e){console.log("catched in searchProducts:"+e),a.$Message.error("获取商品列表失败!")}),this.loadingStatus=!1},changePage:function(e){console.log(e),this.pageNumber=e,this.getProductData(this.pageSize,this.pageNumber)},changePageSize:function(e){console.log(e),this.pageSize=e,this.getProductData(this.pageSize,this.pageNumber)},exportData:function(e){1===e?this.$refs.table.exportCsv({filename:"ProductList"+new Date}):2===e?this.$refs.table.exportCsv({filename:"ProductList_sorted_filtered"+new Date,original:!1}):3===e&&this.$refs.table.exportCsv({filename:"ProductList_customed"+new Date,columns:this.tableColumns.filter(function(e,t){return t<4}),data:this.aList.filter(function(e,t){return t<10})})},cancelAdd:function(){this.showAddModel=!1,this.$Message.info("点击了取消")},confirmAdd:function(e){var t=this;this.$refs[e].validate(function(a){if(a){t.addModelErrors={};var o=r()(t.addModel);o=JSON.parse(o),Object(d.f)(o).then(function(e){var a=e.data,o=e.status,r=e.statusText;201!==o?(t.loginMessage=r,t.addModelErrors=a,t.$Message.error("添加商品失败!"),t.showAddModel=!0):(console.log(a),t.$Message.success("添加商品成功!"),t.getProductData(t.pageSize,t.pageNumber))},function(e){console.log("Error in addProduct: "+e),t.$Message.error("添加商品失败!")}).catch(function(e){console.log("Exception in addProduct: "+e),t.$Message.error("添加商品失败!")})}else console.log(t.$refs[e].errors),console.log(t.addModel),t.$Message.error("表单验证失败!")})},cancelEdit:function(){this.showEditModel=!1,this.$Message.info("点击了取消")},confirmEdit:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.editModelErrors={};var a=JSON.parse(r()(t.editModel));Object(d.z)(a).then(function(e){var a=e.data,o=e.status,r=e.statusText;201!==o?(console.log(r),t.editModelErrors=a,t.$Message.error(o),t.showEditModel=!0):(a.sale_price=Number(a.sale_price),a.price=Number(a.price),console.log(a),t.$Message.success("修改商品成功!"),t.getProductData(t.pageSize,t.pageNumber))},function(e){console.log("Error in editProduct: "+e),t.$Message.error("修改商品失败!")}).catch(function(e){console.log("catched in editProduct:"+e),t.$Message.error("修改商品失败!")})}else t.$Message.error("商品信息校验失败!")})},confirmToggle:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=r()(t.deleteModel);a=JSON.parse(a),Object(d.x)(a).then(function(e){var a=e.status,o=e.statusText;201!==a?t.$Message.error(o):(t.$Message.success("开关商品成功!"),t.getProductData(t.pageSize,t.pageNumber))},function(e){console.log("Error in deleteProduct: "+e),t.$Message.error("开关商品失败!")}).catch(function(e){console.log("catched in deleteProduct:"+e),t.$Message.error("开关商品失败!")})}else t.$Message.error("商品信息校验失败!")})},handleReset:function(e){this.$refs[e].resetFields()},handleFormatError:function(){this.$Message.error(this.$t("format_error"))},handleExceededSize:function(){this.$Message.error(this.$t("exceeded_size_error"))},handleAddFileUploaded:function(e){this.uploadedFile=e,this.addModel.file=this.uploadedFile,this.$refs.addModelUpload.clearFiles(),this.getProductData(this.pageSize,this.pageNumber)},handleAddFileUploadSuccess:function(e,t,a){console.log("file uploaded successfully"),this.$refs.addModelUpload.clearFiles(),this.getProductData(this.pageSize,this.pageNumber),this.$Message.success("修改商品成功!")},handleEditFileUploaded:function(e){this.uploadedFile=e,this.editModel.file=this.uploadedFile,this.$refs.addModelUpload.clearFiles(),this.$refs.editModelUpload.clearFiles(),this.getProductData(this.pageSize,this.pageNumber)},handleEditFileUploadSuccess:function(e,t,a){console.log("file uploaded successfully"),this.$refs.editModelUpload.clearFiles(),this.getProductData(this.pageSize,this.pageNumber),this.$Message.success("修改商品成功!")}},mounted:function(){this.getProductData(this.pageSize,this.pageNumber)}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"product-manage"},[a("Row",{staticClass:"search-box"},[a("Col",{attrs:{span:"8"}},[a("AutoComplete",{attrs:{placeholder:e.$t("localSearch"),icon:"ios-Textsearch",clearable:!0},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},e._l(e.aList,function(t){return a("Option",{key:t.id,attrs:{value:t.name}},[a("span",{staticClass:"product-name"},[e._v(e._s(t.name))]),e._v(" "),a("span",{staticClass:"product-price"},[e._v(e._s(e._f("currency")(t.sale_price)))])])}))],1),e._v(" "),a("Col",{attrs:{span:"3"}},[a("i-button",{attrs:{type:"primary"},on:{click:function(t){e.getProductData(e.pageSize,e.pageNumber)}}},[e._v(e._s(e.$t("remoteSearch")))])],1),e._v(" "),a("Col",{attrs:{span:"4",push:"9"}},[a("i-button",{attrs:{type:"primary"},on:{click:function(t){e.showAddModal=!0}}},[e._v(e._s(e.$t("addProduct")))])],1)],1),e._v(" "),a("Table",{ref:"table",staticClass:"data-table",attrs:{loading:e.loadingStatus,context:e.self,data:e.aList,columns:e.tableColumns,stripe:""}}),e._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.exportData(1)}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),e._v(e._s(e.$t("exportSourceData")))],1),e._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.exportData(2)}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),e._v(e._s(e.$t("exportSortedOrFilteredData")))],1),e._v(" "),a("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.exportData(3)}}},[a("Icon",{attrs:{type:"ios-download-outline"}}),e._v(e._s(e.$t("exportCustomedData")))],1),e._v(" "),a("div",{staticStyle:{margin:"10px",overflow:"hidden"}},[a("div",{staticStyle:{float:"right"}},[a("Page",{attrs:{total:e.total,current:e.pageNumber,"show-sizer":"","show-elevator":"","show-total":"","page-size":e.pageSize,"page-size-opts":[10,20,40,1e4]},on:{"on-change":e.changePage,"on-page-size-change":e.changePageSize}})],1)]),e._v(" "),a("Modal",{attrs:{title:"添加商品"},on:{"on-ok":function(t){e.confirmAdd("addModelForm")},"on-cancel":function(t){e.cancelAdd("addModelForm")}},model:{value:e.showAddModal,callback:function(t){e.showAddModal=t},expression:"showAddModal"}},[a("Form",{ref:"addModelForm",attrs:{model:e.addModel,rules:e.ruleValidate,"label-width":100,enctype:"multipart/form-data","accept-charset":"utf-8"}},[a("Form-item",{attrs:{label:"名称",prop:"name"}},[a("Input",{attrs:{placeholder:"名称"},model:{value:e.addModel.name,callback:function(t){e.$set(e.addModel,"name",t)},expression:"addModel.name"}}),e._v(" "),e._l(e.addModelErrors.name,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"品牌",prop:"brand"}},[a("Input",{attrs:{placeholder:"品牌"},model:{value:e.addModel.brand,callback:function(t){e.$set(e.addModel,"brand",t)},expression:"addModel.brand"}}),e._v(" "),e._l(e.addModelErrors.brand,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"售价",prop:"sale_price"}},[a("InputNumber",{attrs:{max:1e4,min:1,step:.1},model:{value:e.addModel.sale_price,callback:function(t){e.$set(e.addModel,"sale_price",t)},expression:"addModel.sale_price"}}),e._v(" "),e._l(e.addModelErrors.sale_price,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"原价",prop:"price"}},[a("InputNumber",{attrs:{max:1e4,min:1,step:.1},model:{value:e.addModel.price,callback:function(t){e.$set(e.addModel,"price",t)},expression:"addModel.price"}}),e._v(" "),e._l(e.addModelErrors.price,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"图片",prop:"image"}},[a("Upload",{ref:"addModelUpload",attrs:{action:"http://123.56.115.20/sale-manage/product/create/",headers:e.headers,data:e.addModel,format:["jpg","png","jpeg","gif","bmp","svg"],"on-format-error":e.handleFormatError,"max-size":e.maxSize,"on-exceeded-size":e.handleExceededSize,"before-upload":e.handleAddFileUploaded,"on-success":e.handleAddFileUploadSuccess}},[e.uploadedFile?a("div",[a("span",[e._v("选择了图片："+e._s(e.uploadedFile.name))])]):e._e(),e._v(" "),a("span",[e._v("选择图片上传")]),e._v(" "),a("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[e._v("上传文件")]),e._v(" "),e._l(e.addModelErrors.image,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2)],1),e._v(" "),a("Form-item",{attrs:{prop:"is_active"}},[a("Checkbox",{model:{value:e.addModel.is_active,callback:function(t){e.$set(e.addModel,"is_active",t)},expression:"addModel.is_active"}},[e._v("是否在售")]),e._v(" "),e._l(e.addModelErrors.is_active,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{prop:"is_bestseller"}},[a("Checkbox",{model:{value:e.addModel.is_bestseller,callback:function(t){e.$set(e.addModel,"is_bestseller",t)},expression:"addModel.is_bestseller"}},[e._v("是否热销")]),e._v(" "),e._l(e.addModelErrors.is_bestseller,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"描述",prop:"description"}},[a("Input",{attrs:{type:"textarea",placeholder:"商品描述"},model:{value:e.addModel.description,callback:function(t){e.$set(e.addModel,"description",t)},expression:"addModel.description"}}),e._v(" "),e._l(e.addModelErrors.description,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"检索词",prop:"meta_keywords"}},[a("Input",{attrs:{placeholder:"检索词"},model:{value:e.addModel.meta_keywords,callback:function(t){e.$set(e.addModel,"meta_keywords",t)},expression:"addModel.meta_keywords"}}),e._v(" "),e._l(e.addModelErrors.meta_keywords,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),a("Form-item",{attrs:{label:"检索描述",prop:"meta_description"}},[a("Input",{attrs:{type:"textarea",placeholder:"检索描述"},model:{value:e.addModel.meta_description,callback:function(t){e.$set(e.addModel,"meta_description",t)},expression:"addModel.meta_description"}}),e._v(" "),e._l(e.addModelErrors.meta_description,function(t){return a("ul",[a("li",{staticClass:"error"},[e._v(e._s(t))])])})],2)],1)],1),e._v(" "),a("Modal",{attrs:{title:"修改商品"},on:{"on-ok":function(t){e.confirmEdit("editModelForm")},"on-cancel":function(t){e.cancelEdit("editModelForm")}},model:{value:e.showEditModal,callback:function(t){e.showEditModal=t},expression:"showEditModal"}},[a("Form",{ref:"editModelForm",attrs:{model:e.editModel,rules:e.ruleValidate,"label-width":100}},[a("Form-item",{attrs:{label:"名称",prop:"name"}},[a("Input",{attrs:{placeholder:"名称"},model:{value:e.editModel.name,callback:function(t){e.$set(e.editModel,"name",t)},expression:"editModel.name"}})],1),e._v(" "),a("Form-item",{attrs:{label:"品牌",prop:"brand"}},[a("Input",{attrs:{placeholder:"品牌"},model:{value:e.editModel.brand,callback:function(t){e.$set(e.editModel,"brand",t)},expression:"editModel.brand"}})],1),e._v(" "),a("Form-item",{attrs:{label:"售价",prop:"sale_price"}},[a("InputNumber",{attrs:{max:1e4,min:1,step:.1},model:{value:e.editModel.sale_price,callback:function(t){e.$set(e.editModel,"sale_price",t)},expression:"editModel.sale_price"}})],1),e._v(" "),a("Form-item",{attrs:{label:"原价",prop:"price"}},[a("InputNumber",{attrs:{max:1e4,min:1,step:.1},model:{value:e.editModel.price,callback:function(t){e.$set(e.editModel,"price",t)},expression:"editModel.price"}})],1),e._v(" "),a("Form-item",{attrs:{label:"图片",prop:"image"}},[e.editModel.image?[a("img",{staticClass:"product-image",attrs:{src:e.editModel.image.replace("sale-manage/products/shop_frontend/dist/",""),alt:"商品图片"}})]:e._e(),e._v(" "),a("Upload",{ref:"editModelUpload",attrs:{action:"http://123.56.115.20/sale-manage/product/update/",headers:e.headers,data:e.editModel,format:["jpg","png","jpeg","gif","bmp","svg"],"on-format-error":e.handleFormatError,"max-size":e.maxSize,"on-exceeded-size":e.handleExceededSize,"before-upload":e.handleEditFileUploaded,"on-success":e.handleEditFileUploadSuccess}},[e.uploadedFile?a("div",[a("span",[e._v("选择了图片："+e._s(e.uploadedFile.name))])]):e._e(),e._v(" "),a("span",[e._v("选择图片上传")]),e._v(" "),a("Button",{attrs:{type:"ghost",icon:"ios-cloud-upload-outline"}},[e._v("上传文件")])],1)],2),e._v(" "),a("Form-item",{attrs:{prop:"is_active"}},[a("Checkbox",{model:{value:e.editModel.is_active,callback:function(t){e.$set(e.editModel,"is_active",t)},expression:"editModel.is_active"}},[e._v("是否在售")])],1),e._v(" "),a("Form-item",{attrs:{prop:"is_bestseller"}},[a("Checkbox",{model:{value:e.editModel.is_bestseller,callback:function(t){e.$set(e.editModel,"is_bestseller",t)},expression:"editModel.is_bestseller"}},[e._v("是否热销")])],1),e._v(" "),a("Form-item",{attrs:{label:"描述",prop:"description"}},[a("Input",{attrs:{type:"textarea",placeholder:"商品描述"},model:{value:e.editModel.description,callback:function(t){e.$set(e.editModel,"description",t)},expression:"editModel.description"}})],1),e._v(" "),a("Form-item",{attrs:{label:"检索词",prop:"meta_keywords"}},[a("Input",{attrs:{placeholder:"检索词"},model:{value:e.editModel.meta_keywords,callback:function(t){e.$set(e.editModel,"meta_keywords",t)},expression:"editModel.meta_keywords"}})],1),e._v(" "),a("Form-item",{attrs:{label:"检索描述",prop:"meta_description"}},[a("Input",{attrs:{type:"textarea",placeholder:"检索描述"},model:{value:e.editModel.meta_description,callback:function(t){e.$set(e.editModel,"meta_description",t)},expression:"editModel.meta_description"}})],1)],1)],1),e._v(" "),a("Modal",{attrs:{title:"删除商品"},on:{"on-ok":function(t){e.confirmToggle("deleteModelForm")},"on-cancel":function(t){e.cancelDelete("deleteModelForm")}},model:{value:e.showDeleteModal,callback:function(t){e.showDeleteModal=t},expression:"showDeleteModal"}},[a("h3",{staticClass:"warning-title"},[e._v("确认要开关商品？")]),e._v(" "),a("Form",{ref:"deleteModelForm",attrs:{model:e.deleteModel,"label-width":100}},[a("Form-item",{attrs:{label:"名称",prop:"name"}},[a("Input",{attrs:{placeholder:"名称",readonly:!0},model:{value:e.deleteModel.name,callback:function(t){e.$set(e.deleteModel,"name",t)},expression:"deleteModel.name"}})],1),e._v(" "),a("Form-item",{attrs:{label:"售价",prop:"sale_price"}},[a("InputNumber",{attrs:{max:1e4,min:1,step:.1,readonly:!0},model:{value:e.editModel.sale_price,callback:function(t){e.$set(e.editModel,"sale_price",t)},expression:"editModel.sale_price"}})],1),e._v(" "),a("Form-item",{attrs:{label:"原价",prop:"price"}},[a("InputNumber",{attrs:{max:1e4,min:1,step:.1,readonly:!0},model:{value:e.editModel.price,callback:function(t){e.$set(e.editModel,"price",t)},expression:"editModel.price"}})],1)],1)],1)],1)},staticRenderFns:[]};var u=a("ngHh")(n,c,!1,function(e){a("qBHW")},"data-v-53e5621e",null);t.default=u.exports},qBHW:function(e,t){}});
//# sourceMappingURL=13.da4a735bc9193c4d5f04.js.map