webpackJsonp([6],{"2JA4":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("34v0"),o=r.n(a),s=r("EcfS"),n=r("m4jk"),i={components:{"cart-items":r("kJIr").a},data:function(){var e=this;return{availableStocks:[],selectedProduct:null,availableCustomers:[],selectedCustomer:null,addModel:{name:"",amount:0,comment:""},ruleAddValidate:{name:[{validator:function(t,r,a){r?e.availableProducts.filter(function(e,t,a){return e.name===r}).length>0?a():a(new Error(e.$t("invalidProductError"))):a(new Error(e.$t("noProductError")))},trigger:"blur"}],amount:[{validator:function(t,r,a){r?0===r?a(new Error(e.$t("invalidAmountError"))):a():a(new Error(e.$t("noAmountError")))},trigger:"blur"}]},addModelErrors:{},orderModel:{customer:"",payment:"",express:"",express_no:"",cartListLength:0},ruleOrderValidate:{customer:[{validator:function(t,r,a){console.log(r),r?e.availableCustomers.some(function(e,t,a){return e.username===r})?(console.log("name valide"),a()):(console.log("name invalide"),a(new Error(e.$t("invalidCustomerError")))):a(new Error(e.$t("noCustomerError")))},trigger:"blur"}],payment:[{validator:function(t,r,a){r?e.availablePayments.some(function(e,t,a){return e.name===r})?(console.log("name valide"),a()):(console.log("name invalide"),a(new Error(e.$t("invalidPaymentError")))):a()},trigger:"blur"}],cartListLength:[{validator:function(t,r,a){0===e.cartList.length?a(new Error(e.$t("invalidCartListLengthError"))):a()},trigger:"blur"}]},orderErrors:{},addedProducts:[],total:0,pageNumber:1,pageSize:1e5,tableColumns:[{title:"名称",key:"product_name",align:"center",sortable:!0},{title:"价格",key:"product_sale_price",align:"left",sortable:!0,render:function(e,t){return e("span",t.row.sale_price)}},{title:"数量",key:"amount",align:"center",sortable:!0,render:function(t,r){return t("span",{},Number(r.row.amount).toFixed(e.decimals))}},{title:"小计",key:"itemSum",align:"left",sortable:!0,render:function(t,r){return t("span",{props:{color:"red"}},(Number(r.row.product_sale_price)*Number(r.row.amount)).foFixed(e.decimals))}},{title:"备注",key:"comment",align:"left",sortable:!0},{title:"操作",key:"action",width:150,align:"center",render:function(t,r){return t("div",[t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showEdit(r.index)}}},"编辑"),t("Button",{props:{type:"primary",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showDelete(r.index)}}},"开/关")])}}]}},computed:o()({},Object(s.e)("app",{maxSize:function(e){return e.maxSize},currentDepartment:function(e){return e.currentDepartment},availableProducts:function(e){return e.availableProducts},availableExpresses:function(e){return e.availableExpresses},availablePayments:function(e){return e.availablePayments}}),Object(s.e)("login",{currentDepartment:function(e){return e.currentDepartment}}),Object(s.e)("cart",{cartList:function(e){return e.cartList},decimals:function(e){return e.decimals}}),Object(s.c)("cart",["cartListCount","cartListSum"]),{aStockProduct:function(){var e=this;return console.log(this.addModel.name),console.log(this.availableStocks),this.availableStocks.filter(function(t,r,a){return!e.addModel.name||(-1!==t.product_name.toUpperCase().indexOf(e.addModel.name.toUpperCase())||(-1!==t.product_sale_price.toString().indexOf(e.addModel.name.toUpperCase())||(-1!==t.product_pinyin.toUpperCase().indexOf(e.addModel.name.toUpperCase())||-1!==t.product_py.toUpperCase().indexOf(e.addModel.name.toUpperCase()))))})},aCustomer:function(){var e=this;return Array.isArray(this.availableCustomers)?this.availableCustomers.filter(function(t,r,a){return!e.orderModel.customer||(-1!==t.username.toUpperCase().indexOf(e.orderModel.customer.toUpperCase())||-1!==t.cell_phone.toUpperCase().indexOf(e.orderModel.customer.toUpperCase()))}):this.availableCustomers},aExpress:function(){var e=this;return Array.isArray(this.availableExpresses)?this.availableExpresses.filter(function(t,r,a){return!e.orderModel.express||(-1!==t.name.toUpperCase().indexOf(e.orderModel.express.toUpperCase())||(-1!==t.pinyin.toUpperCase().indexOf(e.orderModel.express.toUpperCase())||-1!==t.py.toUpperCase().indexOf(e.orderModel.express.toUpperCase())))}):this.availableExpresses},aPayment:function(){var e=this;return Array.isArray(this.availablePayments)?this.availablePayments.filter(function(t,r,a){return!e.orderModel.payment||(-1!==t.name.toUpperCase().indexOf(e.orderModel.payment.toUpperCase())||(-1!==t.pinyin.toUpperCase().indexOf(e.orderModel.payment.toUpperCase())||-1!==t.py.toUpperCase().indexOf(e.orderModel.payment.toUpperCase())))}):this.availablePayments}}),watch:{currentDepartment:function(){this.getStockData(this.pageSize,this.pageNumber)}},methods:{getStockData:function(e,t){var r=this,a={department:this.currentDepartment.code,limit:e,offset:(t-1)*e};Object(n.w)(a).then(function(e){var t=e.data,a=e.status,o=e.statusText;200!==a?r.loginMessage=o:(r.total=e.data.count,r.availableStocks=t.results)},function(e){console.log("Error in getStockDatas: "+e),r.$Message.error("获取商品列表失败!")}).catch(function(e){console.log("catched in getStockDatas:"+e),r.$Message.error("获取商品列表失败!")}),this.loadingStatus=!1},getCustomerData:function(e,t){var r=this,a={limit:e,offset:(t-1)*e};Object(n.h)(a).then(function(e){var t=e.data,a=e.status,o=e.statusText;200!==a?r.loginMessage=o:(r.total=e.data.count,r.availableCustomers=t.results)},function(e){r.$Message.error(e)}).catch(function(e){r.$Message.error(e)}),this.loadingStatus=!1},handleProductSelected:function(e){var t=this;if(this.addModel.name=e,e)if(this.addModel.name.length>0&&this.availableProducts.length>0){var r=this.availableProducts.filter(function(e,r,a){return e.name===t.addModel.name});this.selectedProduct=r[0]}else console.error("invalideProduct"),this.$Message.error("invalideProduct")},handleCustomerSelected:function(e){var t=this;if(this.orderModel.customer=e,e)if(this.orderModel.customer.length>0&&this.availableCustomers.length>0){var r=this.availableCustomers.filter(function(e,r,a){return e.username===t.orderModel.customer});this.selectedCustomer=r[0]}else this.$Message.error("invalideCustomer")},handleExpressSelected:function(e){var t=this;if(this.orderModel.express=e,e)if(this.orderModel.express.length>0&&this.availableExpresses.length>0){var r=this.availableExpresses.filter(function(e,r,a){return e.name===t.orderModel.express});this.selectedExpress=r[0]}else this.$Message.error("invalideExpresses")},handlePaymentSelected:function(e){var t=this;if(this.orderModel.payment=e,e)if(this.orderModel.payment.length>0&&this.availablePayments.length>0){var r=this.availablePayments.filter(function(e,r,a){return e.name===t.orderModel.payment});this.selectedPayment=r[0]}else this.$Message.error("invalidePayment")},addToCart:function(){var e=this;console.log("addToCart"),this.$refs.addModelForm.validate(function(t){console.log("addToCart validating"),t?(console.log("valid"),e.$store.dispatch("cart/addCartItem",{item:e.selectedProduct,amount:e.addModel.amount,comment:e.addModel.comment}),e.$Message.success({title:"加入购物车成功",content:"加入购物车成功"})):(console.log("invalid"),e.$Message.error(e.$t("invalideOrder")))})},submitOrder:function(){var e=this;this.$refs.submitOrderForm.validate(function(t){if(console.log(t),t){var r={department:e.currentDepartment,customer:e.selectedCustomer,payment:e.selectedPayment,cartList:e.cartList,cartListCount:e.cartListCount,cartListSum:e.cartListSum.toFixed(e.decimals),express:e.selectedExpress,express_no:e.orderModel.express_no};console.log(r),Object(n.b)(r).then(function(t){var r=t.data,a=t.status,o=t.statusText;if(201!==a)console.log("submit order fail:"+o);else{var s=r.order_no.substring(0,4)+e.$t("orderAddedSucceed");e.$Message.success({title:e.$t("orderAddedSucceed"),content:s}),e.$store.dispatch("cart/emptyCart")}},function(t){e.$Message.error(t)}).catch(function(t){e.$Message.error(t)})}else console.log("invalid"),e.$Message.error(e.$t("invalideOrder"))})}},mounted:function(){this.getStockData(this.pageSize,this.pageNumber),this.getCustomerData(this.pageSize,this.pageNumber)}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"order-manage"},[r("div",{staticClass:"cart-items"},[r("cart-items")],1),e._v(" "),r("div",{staticClass:"cart-enter"},[r("Form",{ref:"addModelForm",attrs:{model:e.addModel,rules:e.ruleAddValidate,"label-position":"left",inline:""}},[r("Form-item",{attrs:{label:e.$t("product"),prop:"name"}},[r("AutoComplete",{attrs:{placeholder:e.$t("selectProduct"),icon:"ios-search",clearable:!0},on:{"on-select":e.handleProductSelected},model:{value:e.addModel.name,callback:function(t){e.$set(e.addModel,"name",t)},expression:"addModel.name"}},e._l(e.aStockProduct,function(t){return r("Option",{key:t.id,attrs:{value:t.product_name}},[r("span",{staticClass:"product-name"},[e._v(e._s(t.product_name))]),e._v(" "),r("span",{staticClass:"product-sale-price"},[e._v(e._s(e._f("currency")(t.product_sale_price)))]),e._v(" "),r("span",{staticClass:"product-amount"},[e._v(e._s(t.amount))]),e._v(" "),r("span",{staticClass:"product-batch-no"},[e._v(e._s(t.batch_no))])])})),e._v(" "),e._l(e.addModelErrors.name,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{attrs:{label:e.$t("amount"),prop:"amount"}},[r("InputNumber",{attrs:{max:1e4,min:.1,step:.1},model:{value:e.addModel.amount,callback:function(t){e.$set(e.addModel,"amount",t)},expression:"addModel.amount"}}),e._v(" "),e._l(e.addModelErrors.amount,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{attrs:{label:e.$t("comment"),prop:"comment"}},[r("Input",{attrs:{type:"text"},model:{value:e.addModel.comment,callback:function(t){e.$set(e.addModel,"comment",t)},expression:"addModel.comment"}}),e._v(" "),e._l(e.addModelErrors.comment,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",[r("br"),e._v(" "),r("Button",{attrs:{type:"primary"},on:{click:function(t){e.addToCart()}}},[e._v(e._s(e.$t("addToCart")))])],1)],1),e._v(" "),r("br")],1),e._v(" "),r("div",{staticClass:"order-info"},[r("Form",{ref:"submitOrderForm",attrs:{model:e.orderModel,rules:e.ruleOrderValidate,"label-position":"left",inline:""}},[r("Form-item",{attrs:{label:e.$t("customer"),prop:"customer"}},[r("AutoComplete",{attrs:{placeholder:e.$t("selectCustomer"),icon:"ios-search",clearable:!0},on:{"on-select":e.handleCustomerSelected},model:{value:e.orderModel.customer,callback:function(t){e.$set(e.orderModel,"customer",t)},expression:"orderModel.customer"}},e._l(e.aCustomer,function(t){return r("Option",{key:t.id,attrs:{value:t.username}},[r("span",{staticClass:"product-name"},[e._v(e._s(t.username))]),e._v(" "),r("span",{staticClass:"product-price"},[e._v(e._s(t.last_name))]),e._v(" "),r("span",{staticClass:"product-price"},[e._v(e._s(t.first_name))]),e._v(" "),r("span",{staticClass:"product-price"},[e._v(e._s(t.cell_phone))])])})),e._v(" "),e._l(e.orderErrors.customer,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{attrs:{label:e.$t("payment"),prop:"payment"}},[r("AutoComplete",{attrs:{placeholder:e.$t("selectPayment"),icon:"ios-search",clearable:!0},on:{"on-select":e.handlePaymentSelected},model:{value:e.orderModel.payment,callback:function(t){e.$set(e.orderModel,"payment",t)},expression:"orderModel.payment"}},e._l(e.aPayment,function(t){return r("Option",{key:t.id,attrs:{value:t.name}},[r("span",{staticClass:"product-name"},[e._v(e._s(t.name))])])})),e._v(" "),e._l(e.orderErrors.payment,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{attrs:{label:e.$t("express"),prop:"express"}},[r("AutoComplete",{attrs:{placeholder:e.$t("selectExpress"),icon:"ios-search",clearable:!0},on:{"on-select":e.handleExpressSelected},model:{value:e.orderModel.express,callback:function(t){e.$set(e.orderModel,"express",t)},expression:"orderModel.express"}},e._l(e.aExpress,function(t){return r("Option",{key:t.id,attrs:{value:t.name}},[r("span",{staticClass:"product-name"},[e._v(e._s(t.name))])])})),e._v(" "),e._l(e.orderErrors.express,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{attrs:{label:e.$t("expressNo"),prop:"express_no"}},[r("Input",{attrs:{type:"text"},model:{value:e.orderModel.express_no,callback:function(t){e.$set(e.orderModel,"express_no",t)},expression:"orderModel.express_no"}}),e._v(" "),e._l(e.orderErrors.express_no,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{attrs:{label:e.$t("comment"),prop:"comment"}},[r("Input",{attrs:{type:"text"},model:{value:e.orderModel.comment,callback:function(t){e.$set(e.orderModel,"comment",t)},expression:"orderModel.comment"}}),e._v(" "),e._l(e.orderErrors.comment,function(t){return r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])])})],2),e._v(" "),r("Form-item",{staticStyle:{display:"none"},attrs:{prop:"cartListLength"}},[r("InputNumber",{attrs:{type:"text"},model:{value:e.orderModel.cartListLength,callback:function(t){e.$set(e.orderModel,"cartListLength",t)},expression:"orderModel.cartListLength"}})],1),e._v(" "),r("Form-item",[r("br"),e._v(" "),r("Button",{attrs:{type:"primary",size:"large"},on:{click:e.submitOrder}},[r("Icon",{attrs:{type:"ios-download-outline"}}),e._v(e._s(e.$t("submitOrder")))],1)],1)],1)],1)])},staticRenderFns:[]};var c=r("ngHh")(i,l,!1,function(e){r("SiZa")},"data-v-1b5e2e83",null);t.default=c.exports},"QlC+":function(e,t){},SiZa:function(e,t){},kJIr:function(e,t,r){"use strict";var a=r("3SZ7"),o=r.n(a),s=r("34v0"),n=r.n(s),i=r("EcfS"),l=r("m4jk"),c={data:function(){var e=this;return{emptyConfirm:!1,toDepartment:null,cartListColumns:[{title:this.$t("product"),key:"name",sortable:!0,render:function(e,t){return e("router-link",{props:{to:{name:"detail",params:{productId:t.row.id}}}},t.row.name)}},{title:this.$t("sale_price"),key:"sale_price",sortable:!0},{title:this.$t("decrease"),key:"decrease",render:function(t,r){return t("div",[t("Button",{props:{type:"warning",size:"small",shape:"circle"},on:{click:function(){e.decreaseCartItemAmount(r.row)}}},"-")])}},{title:this.$t("amount"),key:"amount",sortable:!0,render:function(t,r){return t("span",r.row.amount.toFixed(e.decimals))}},{title:this.$t("increase"),key:"increase",render:function(t,r){return t("div",[t("Button",{props:{type:"warning",size:"small",shape:"circle"},on:{click:function(){e.increaseCartItemAmount(r.row)}}},"+")])}},{title:this.$t("itemSum"),key:"itemSum",render:function(t,r){return t("span",(r.row.sale_price*r.row.amount).toFixed(e.decimals))}},{title:this.$t("comment"),key:"comment",render:function(e,t){return e("span",t.row.comment)}},{title:this.$t("action"),key:"action",render:function(t,r){return t("div",[t("Button",{props:{type:"error",size:"small"},on:{click:function(){e.removeCartItem(r.row)}}},e.$t("delete"))])}}]}},computed:n()({},Object(i.e)({otherDepartments:function(e){var t=JSON.parse(o()(e.departments.results));return e.login.currentUser?t.filter(function(t,r,a){return t.id!==e.login.currentUser.department}):(console.error(e.login.currentUser),t)}}),Object(i.e)("cart",{cartList:function(e){return e.cartList},decimals:function(e){return e.decimals}}),Object(i.c)("cart",["cartListCount","cartListSum"])),methods:n()({},Object(i.b)(["setDepartments"]),Object(i.b)("cart",["emptyCart","setCartList","removeCartItem","resetCartList","decreaseCartItemAmount","increaseCartItemAmount"])),mounted:function(){console.debug("Cart.vue mounted")},beforeCreate:function(){var e=this;Object(l.i)().then(function(t){e.setDepartments(t.data).then(function(){console.debug("state product list set")})}).catch(function(e){console.error(e)})}},d={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"cart"},[t("Table",{ref:"cartList",attrs:{stripe:"",columns:this.cartListColumns,data:this.cartList}},[t("div",{staticClass:"table-header",attrs:{slot:"header"},slot:"header"},[this._v("\n      已添加商品列表\n    ")]),this._v(" "),t("div",{staticClass:"table-footer",attrs:{slot:"footer"},slot:"footer"},[this._v("\n      共计: "),t("span",[this._v(this._s(this.cartListCount))]),this._v(" 种商品，合计: "),t("span",[this._v(this._s(this._f("currency")(this.cartListSum)))])])]),this._v(" "),t("br")],1)},staticRenderFns:[]};var u=r("ngHh")(c,d,!1,function(e){r("QlC+")},"data-v-28a19819",null);t.a=u.exports}});
//# sourceMappingURL=6.6fbf6d98c266eaaa08bc.js.map