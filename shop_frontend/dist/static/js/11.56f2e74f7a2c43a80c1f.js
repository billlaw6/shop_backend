webpackJsonp([11],{"6tPm":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("34v0"),n=r.n(o),i=r("EcfS"),s=r("m4jk"),a={components:{},data:function(){var e=this;return{selectedProduct:null,selectedToDept:null,ruleInline:{productInfo:[{validator:function(t,r,o){r?e.availableProducts.filter(function(e,t,o){return e.name===r}).length>0?o():o(new Error(e.$t("invalidProductError"))):o(new Error(e.$t("noProductError")))},trigger:"blur"},{required:!0,message:this.$t("invalidProduct"),trigger:"blur"}],move_amount:[{validator:function(t,r,o){r?r>=.1&&r<1e3?o():o(new Error(e.$t("invalidMoveAmountError"))):o(new Error(e.$t("noMoveAmountError")))},trigger:"blur"}]},ruleInlineSubmit:{toDept:[{validator:function(t,r,o){r?e.otherDepartments.filter(function(e,t,o){return e.name===r}).length>0?o():o(new Error(e.$t("invalidDepartmentError"))):o(new Error(e.$t("noDepartmentError")))},trigger:"blur"}]},formInline:{productInfo:"",move_amount:0,batch_no:"",comment:""},formInlineErrors:{},formInlineSubmit:{toDept:""},loadingProduct:!1,moveRecordListColumns:[{title:this.$t("product"),key:"product.name",sortable:!0,render:function(e,t){return e("span",t.row.product.name)}},{title:this.$t("salePrice"),key:"sale_price",sortable:!0,render:function(t,r){return t("span",parseFloat(r.row.product.sale_price).toFixed(e.decimals))}},{title:this.$t("moveAmount"),key:"move_amount",sortable:!0,render:function(t,r){return t("span",r.row.moveAmount.toFixed(e.decimals))}},{title:this.$t("batchNo"),key:"batch_no",sortable:!0},{title:"操作",key:"action",render:function(t,r){return t("Button",{props:{type:"error",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.removeFromList(r.index)}}},e.$t("remove"))}}]}},computed:n()({},Object(i.e)("app",{availableProducts:function(e){return e.availableProducts},availableDepartments:function(e){return e.availableDepartments}}),Object(i.e)("login",{currentDepartment:function(e){return e.currentDepartment}}),Object(i.e)("stock",{moveRecordList:function(e){return e.moveRecordList},decimals:function(e){return e.decimals}}),Object(i.c)("stock",["moveRecordListCount","moveRecordListSum"]),{otherDepartments:function(){var e=this;return this.availableDepartments.length>0&&this.currentDepartment?this.availableDepartments.filter(function(t,r,o){return e.currentDepartment.code!==t.code&&(!e.formInlineSubmit.toDept||(-1!==t.name.toUpperCase().indexOf(e.formInlineSubmit.toDept.toUpperCase())||(-1!==t.pinyin.toUpperCase().indexOf(e.formInlineSubmit.toDept.toUpperCase())||-1!==t.py.toUpperCase().indexOf(e.formInlineSubmit.toDept.toUpperCase()))))}):this.availableDepartments},total:function(){return this.moveRecordList.length},aProduct:function(){var e=this;return this.availableProducts.filter(function(t,r,o){return!e.formInline.productInfo||(-1!==t.name.toUpperCase().indexOf(e.formInline.productInfo.toUpperCase())||(-1!==t.sale_price.toString().indexOf(e.formInline.productInfo.toUpperCase())||(-1!==t.pinyin.toUpperCase().indexOf(e.formInline.productInfo.toUpperCase())||-1!==t.py.toUpperCase().indexOf(e.formInline.productInfo.toUpperCase()))))})}}),methods:n()({},Object(i.b)("app",{setProducts:"setProducts",setCurrentDepartment:"setCurrentDepartment"}),Object(i.b)("stock",{addMoveRecordItem:"addMoveRecordItem",removeMoveRecordItem:"removeMoveRecordItem",emptyMoveRecord:"emptyMoveRecord",setMoveRecordList:"setMoveRecordList"}),{handleProductSelected:function(e){var t=this;if(this.formInline.productInfo=e,e)if(this.formInline.productInfo.length>0&&this.availableProducts.length>0){var r=this.availableProducts.filter(function(e,r,o){return e.name===t.formInline.productInfo});this.selectedProduct=r[0]}else this.$Message.error("invalideProduct")},addToList:function(){var e=this;this.$refs.formInline.validate(function(t){t?e.$store.dispatch("stock/addMoveRecordItem",{item:e.selectedProduct,moveAmount:e.formInline.move_amount,batchNo:e.formInline.batch_no,comment:e.formInline.comment}):e.$Message.error(e.$t("validateFailed"))})},removeFromList:function(e){this.removeMoveRecordItem(this.moveRecordList[e])},handleToDeptSelected:function(e){var t=this;if(this.formInlineSubmit.toDept=e,e)if(this.formInlineSubmit.toDept.length>0&&this.otherDepartments.length>0){var r=this.otherDepartments.filter(function(e,r,o){return e.name===t.formInlineSubmit.toDept});this.selectedToDept=r[0]}else this.$Message.error("invalideToDept")},submitMoveIn:function(){var e=this;if(this.currentDepartment&&this.moveRecordList.length>0){var t={deptIn:this.currentDepartment,moveRecordList:this.moveRecordList};Object(s.a)(t).then(function(t){201===t.status?(e.$Message.success(e.$t("submitSucceed")),e.emptyMoveRecord()):e.$Message.error(e.$t("failed"))})}else this.$Message.error(this.$t("请先录入商品"))},submitMoveOut:function(){var e=this;if(this.currentDepartment&&this.moveRecordList.length>0){var t={deptOut:this.currentDepartment,deptIn:this.selectedToDept,moveRecordList:this.moveRecordList};Object(s.a)(t).then(function(t){201===t.status?(e.$Message.success(e.$t("submitSucceed")),e.emptyMoveRecord()):e.$Message.error(e.$t("failed"))})}else this.$Message.error(this.$t("请先录入商品"))}}),mounted:function(){}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"stock-move-in"},[r("Table",{ref:"moveRecordList",attrs:{stripe:"",columns:e.moveRecordListColumns,data:e.moveRecordList}},[r("div",{staticClass:"table-header",attrs:{slot:"header"},slot:"header"},[e._v("\n      已添加商品\n    ")]),e._v(" "),r("div",{staticClass:"table-footer",attrs:{slot:"footer"},slot:"footer"},[e._v("\n      共计: "),r("span",[e._v(e._s(e.total))]),e._v(" 订单，合计: "),r("span")])]),e._v(" "),r("Form",{ref:"formInline",attrs:{model:e.formInline,rules:e.ruleInline,inline:""}},[r("FormItem",{attrs:{label:e.$t("product"),prop:"productInfo"}},[r("AutoComplete",{attrs:{placeholder:e.$t("selectProduct"),icon:"ios-search",clearable:!0},on:{"on-select":e.handleProductSelected},model:{value:e.formInline.productInfo,callback:function(t){e.$set(e.formInline,"productInfo",t)},expression:"formInline.productInfo"}},e._l(e.aProduct,function(t){return r("Option",{key:t.id,attrs:{value:t.name}},[r("span",{staticClass:"product-name"},[e._v(e._s(t.name))]),e._v(" "),r("span",{staticClass:"product-price"},[e._v(e._s(e._f("currency")(t.sale_price)))])])})),e._v(" "),e._l(e.formInlineErrors.productInfo,function(t){return e.formInlineErrors.productInfo?r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])]):e._e()})],2),e._v(" "),r("FormItem",{attrs:{label:e.$t("moveAmount"),prop:"move_amount"}},[r("InputNumber",{attrs:{max:1e4,min:.1,step:.1},model:{value:e.formInline.move_amount,callback:function(t){e.$set(e.formInline,"move_amount",t)},expression:"formInline.move_amount"}}),e._v(" "),e._l(e.formInlineErrors.move_amount,function(t){return e.formInlineErrors.move_amount?r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])]):e._e()})],2),e._v(" "),r("FormItem",{attrs:{label:e.$t("batchNo"),prop:"batch_no"}},[r("Input",{model:{value:e.formInline.batch_no,callback:function(t){e.$set(e.formInline,"batch_no",t)},expression:"formInline.batch_no"}}),e._v(" "),e._l(e.formInlineErrors.batch_no,function(t){return e.formInlineErrors.batch_no?r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])]):e._e()})],2),e._v(" "),r("FormItem",{attrs:{label:e.$t("comment"),prop:"comment"}},[r("Input",{attrs:{type:"text"},model:{value:e.formInline.comment,callback:function(t){e.$set(e.formInline,"comment",t)},expression:"formInline.comment"}}),e._v(" "),e._l(e.formInlineErrors.comment,function(t){return e.formInlineErrors.comment?r("ul",[r("li",{staticClass:"error"},[e._v(e._s(t))])]):e._e()})],2),e._v(" "),r("Form-item",[r("br"),e._v(" "),r("Button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.addToList()}}},[e._v(e._s(e.$t("addToList")))])],1)],1),e._v(" "),r("Form",{ref:"formInlineSubmit",attrs:{model:e.formInlineSubmit,rules:e.ruleInlineSubmit,inline:""}},[r("Tabs",[r("TabPane",{directives:[{name:"show",rawName:"v-show",value:1===e.currentDepartment.level,expression:"currentDepartment.level===1"}],attrs:{label:e.$t("moveIn"),icon:""}},[r("Form-item",[r("br"),e._v(" "),r("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.submitMoveIn()}}},[e._v(e._s(e.$t("submitMoveIn")))])],1)],1),e._v(" "),r("TabPane",{attrs:{label:e.$t("moveOut"),icon:""}},[r("FormItem",{attrs:{label:e.$t("toDepartment"),prop:"toDepartment"}},[r("AutoComplete",{attrs:{placeholder:e.$t("selectToDept"),icon:"ios-search",clearable:!0},on:{"on-select":e.handleToDeptSelected},model:{value:e.formInlineSubmit.toDept,callback:function(t){e.$set(e.formInlineSubmit,"toDept",t)},expression:"formInlineSubmit.toDept"}},e._l(e.otherDepartments,function(t){return r("Option",{key:t.code,attrs:{value:t.name}},[r("span",{staticClass:"product-name"},[e._v(e._s(t.name))])])}))],1),e._v(" "),r("Form-item",[r("br"),e._v(" "),r("Button",{attrs:{type:"primary",size:"large"},on:{click:function(t){e.submitMoveOut()}}},[e._v(e._s(e.$t("submitMoveOut")))])],1)],1)],1)],1)],1)},staticRenderFns:[]};var c=r("ngHh")(a,l,!1,function(e){r("K5Nx")},"data-v-18df60b1",null);t.default=c.exports},K5Nx:function(e,t){}});
//# sourceMappingURL=11.56f2e74f7a2c43a80c1f.js.map